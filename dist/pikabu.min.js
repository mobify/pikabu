/*! pikabu 2.0.0 (https://github.com/mobify/pikabu.git) */
!function(a){if("function"==typeof define&&define.amd)define(["$","plugin","bouncefix","velocity","lockup","shade","deckard"],a);else{var b=window.Zepto||window.jQuery;a(b,window.Plugin,window.bouncefix)}}(function(a,b,c,d){function e(a,b){e.__super__.call(this,a,b,e.DEFAULTS)}var f="Pikabu requires a declared effect to operate. For more information read: https://github.com/mobify/pikabu#initializing-the-plugin",g="a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]",h="input, select, textarea";Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a)}});var i=a.os.ios&&a.os.major<=7,j={PIKABU:"pikabu__drawer",ELEMENT:"pikabu__element",CONTAINER:"pikabu__container",VIEWPORT:"pikabu",HEADER:"pikabu__header",WRAPPER:"pikabu__wrapper",SPACER:"pikabu__spacer",TITLE:"pikabu__title",CLOSE:"pikabu__close",CONTENT:"pikabu__content",OPENED:"pikabu--is-open",SCROLLABLE:"pikabu--is-scrollable",FIXED:"pikabu__fixed"},k={COMPONENT:'<{0} class="'+j.VIEWPORT+'__{0}">{1}</{0}>',HEADER:'<h1 class="'+j.TITLE+'">{0}</h1><button class="'+j.CLOSE+'">Close</button>',FOOTER:"{0}"},l={click:"click.pikabu",focus:"focus.pikabu",blur:"blur.pikabu"};return e.VERSION="2.0.0",e.DEFAULTS={effect:null,container:a("."+j.CONTAINER),appendTo:a("."+j.VIEWPORT),structure:{header:!1,footer:!1},zIndex:0,cssClass:"",coverage:"80%",easing:"swing",duration:200,shade:{zIndex:2},open:a.noop,opened:a.noop,close:a.noop,closed:a.noop,scrollDuration:50,spacerHeight:300},b.create("pikabu",e,{animation:{beginClose:function(){this.options.shade&&this.$shade.shade("close")},openComplete:function(){this._trigger("opened"),this._focus(),window.scrollTo(0,0)},closeComplete:function(){this._resetFocus(),this.$viewport.removeClass(j.OPENED),this.$viewport.css("height",""),this.$animators.css("transform",""),this.$pikabu.lockup("unlock"),this.$pikabu.hide(),this._trigger("closed")}},_init:function(b){if(this.id="pikabu-"+a.uniqueId(),this.$element=a(b),this.$doc=a(document),this.$body=a("body"),this.$animators=a("."+j.CONTAINER+", ."+j.FIXED),this.$animators.add(a(this.options.container)[0]),this._build(),!this.options.effect)throw f;this.effect=this.options.effect.call(this),this.$element.removeAttr("hidden"),this._bindEvents()},toggle:function(){this[this.$pikabu.hasClass(j.OPENED)?"close":"open"]()},open:function(){this._isOpen()||this._isAnimating()||(this._trigger("open"),c.add(j.SCROLLABLE),this.$pikabu.lockup("lock"),this.$pikabu.show(),this.$viewport.height(window.innerHeight),this.effect.open.call(this),this.options.shade&&this.$shade.shade("open"),this.$pikabu.addClass(j.OPENED),this.$viewport.addClass(j.OPENED))},close:function(){this._isOpen()&&!this._isAnimating()&&(this._trigger("close"),c.remove(j.SCROLLABLE),this.$pikabu.removeClass(j.OPENED),this.effect.close.call(this))},_isOpen:function(){return this.$pikabu.hasClass(j.OPENED)},_isAnimating:function(){return this.$container.hasClass("velocity-animating")},_bindEvents:function(){this.$pikabu.on("touchmove",function(b){a(b.target).parents().hasClass(j.CONTENT)||b.preventDefault()})},_build:function(){var b=this;if(this.$pikabu=a("<section />").addClass(j.PIKABU).addClass(this.options.cssClass).css({position:"fixed",zIndex:this.options.zIndex,width:this.options.coverage,height:this.options.coverage}).lockup({container:this.options.container,locked:function(){b._handleKeyboardShown()},unlocked:function(){b._handleKeyboardHidden()}}),this.$viewport=a(this.options.appendTo).on(l.click,"."+j.CLOSE,function(a){a.preventDefault(),b.close()}),this.$container=this.$pikabu.data("lockup").$container.addClass(j.CONTAINER),this.$pikabu.appendTo(this.$viewport),this.options.structure){var c=a("<div />").addClass(j.WRAPPER).appendTo(this.$pikabu);this._buildComponent("header").appendTo(c),a("<div />").addClass(j.CONTENT).addClass(j.SCROLLABLE).append(this.$element.addClass(j.ELEMENT)).append(this.$spacer).appendTo(c),this._buildComponent("footer").appendTo(c)}else this.$element.addClass(j.ELEMENT).appendTo(this.$pikabu);this.$header=this.$pikabu.find("."+j.HEADER),this.$content=this.$pikabu.find("."+j.CONTENT),this.$spacer=a("<div />").addClass(j.SPACER).height(this.options.spacerHeight).attr("hidden","hidden").appendTo(this.$content),this._addAccessibility(),this.options.shade&&(this.$shade=this.$viewport.shade(a.extend(!0,this.options.shade,{append:"appendTo",click:function(){a("."+j.ELEMENT).pikabu("close")}})),this.$shadeEl=this.$viewport.data("shade").$shade),this.$animators=this.$animators.add(this.$shadeEl)},_buildComponent:function(b){var c=this.options.structure[b],d=a([]);if(c!==!1){var e=this._isHtml(c)?c:k[b.toUpperCase()].replace("{0}",c);d=a(k.COMPONENT.replace(/\{0\}/g,b).replace(/\{1\}/g,e))}return d},_isHtml:function(a){return/<[a-z][\s\S]*>/i.test(a)},_coverage:function(a){var b,c=this.options.coverage.match(/(\d*)%$/);return c&&(b=100-parseInt(c[1]),a&&(b/=a)),c?b+"%":this.options.coverage},_addAccessibility:function(){var a=this.id+"__header",b=this.$pikabu.find("h1, ."+j.TITLE).first(),c=this.$pikabu.find("."+j.WRAPPER);this.$container.attr("aria-hidden","false"),this.$pikabu.attr("role","dialog").attr("aria-labelledby",a).attr("aria-hidden","true").attr("tabindex","-1"),c.attr("role","document"),b.attr("id",a)},_focus:function(){this.originalActiveElement=document.activeElement,this._disableInputs(),this.$pikabu.attr("aria-hidden","false"),this.$pikabu.children().first().focus(),this.$container.attr("aria-hidden","true")},_resetFocus:function(){this._enableInputs(),this.$container.attr("aria-hidden","false"),this.$pikabu.attr("aria-hidden","true"),this.originalActiveElement.focus()},_disableInputs:function(){var b=a(g).not(function(){return a(this).closest(".pikabu").length});b.each(function(b,c){var d=a(c),e=d.attr("tabindex")||0;d.data("tabindex",e).attr("tabindex","-1")})},_enableInputs:function(){var b=a("[data-pikabu-tabindex]");b.each(function(b,c){var d=a(c),e=d.data("tabindex");e?d.attr("tabindex",e):d.removeAttr("tabindex"),d.removeData("tabindex")})},_handleKeyboardShown:function(){i&&this.$pikabu.find(h).on(l.focus,this._inputFocus.bind(this)).on(l.blur,this._inputBlur.bind(this))},_handleKeyboardHidden:function(){i&&this.$pikabu.find(h).off(l.focus).off(l.blur)},_inputFocus:function(){this.$spacer.removeAttr("hidden"),d.animate(this._scrollTarget(),"scroll",{container:this.$content[0],offset:-1*(this.$header.height()+parseInt(this.$content.css("padding-top"))),duration:this.options.scrollDuration})},_inputBlur:function(){!this._activeElement().is(h)&&this.$spacer.attr("hidden","")},_activeElement:function(){return a(document.activeElement)},_scrollTarget:function(){for(var a=this._activeElement(),b=a.parent();"relative"===b.css("position")&&!b.hasClass(j.CONTENT);)a=b,b=a.parent();return a}}),a("[data-pikabu]").each(function(){var b=a(this),c=a(this).data("pikabu");if(!c.length)throw f;b.pikabu({effect:c})}),a});